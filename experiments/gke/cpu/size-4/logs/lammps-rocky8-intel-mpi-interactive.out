Defaulted container "lammps" out of: lammps, flux-view (init)
#!/bin/bash
set -euo pipefail
mkdir -p /tmp/output
flux resource list
for i in {1..5}
do
  echo "FLUX-RUN START lammps-iter-$i"
  flux run --setattr=user.study_id=lammps-iter-$i -N4 -n 352 -o cpu-affinity=per-task -o gpu-affinity=off     /usr/bin/lmp -v x 32 -v y 16 -v z 16 -in in.reaxff.hns -nocite |& tee /tmp/lammps.out
  
   echo "FLUX-RUN END lammps-iter-$i"
done


output=./results/${app}
(apt-get update && apt-get install -y jq) || (yum update -y && yum install -y jq)
mkdir -p $output
for jobid in $(flux jobs -a --json | jq -r .jobs[].id); do
    echo
    study_id=$(flux job info $jobid jobspec | jq -r ".attributes.user.study_id")
    echo "FLUX-JOB START ${jobid} ${study_id}"
    echo "FLUX-JOB-JOBSPEC START"
    flux job info $jobid jobspec
    echo "FLUX-JOB-JOBSPEC END" 
    
    echo "FLUX-JOB-RESOURCES START"
    flux job info ${jobid} R
    echo "FLUX-JOB-RESOURCES END"
    echo "FLUX-JOB-EVENTLOG START" 
    flux job info $jobid guest.exec.eventlog
    echo "FLUX-JOB-EVENTLOG END" 
    echo "FLUX-JOB END ${jobid} ${study_id}"
done
echo "FLUX JOB STATS"
flux job stats         

     STATE NNODES NCORES NGPUS NODELIST
      free      4    352     0 lammps-[0-3]
 allocated      0      0     0 
      down      0      0     0 
FLUX-RUN START lammps-iter-1
     STATE NNODES NCORES NGPUS NODELIST
      free      4    352     0 lammps-[0-3]
 allocated      0      0     0 
      down      0      0     0 
[root@lammps-0 HNS]# for i in {1..5}
> do
>   echo "FLUX-RUN START lammps-iter-$i"
>   flux run --setattr=user.study_id=lammps-iter-$i -N4 -n 352 -o cpu-affinity=per-task -o gpu-affinity=off     /usr/bin/lmp -v x 32 -v y 16 -v z 16 -in in.reaxff.hns -nocite |& tee /tmp/lammps.out
>   
>    echo "FLUX-RUN END lammps-iter-$i"
> done
FLUX-RUN START lammps-iter-1
LAMMPS (2 Apr 2025 - Development - 3215141)
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread. (src/comm.cpp:99)
  using 1 OpenMP thread(s) per MPI task
Reading data file ...
  triclinic box = (0 0 0) to (22.326 11.1412 13.778966) with tilt (0 -5.02603 0)
  11 by 4 by 8 MPI processor grid
  reading atoms ...
  304 atoms
  reading velocities ...
  304 velocities
  read_data CPU = 0.006 seconds
Replication is creating a 32x16x16 = 8192 times larger system...
  triclinic box = (0 0 0) to (714.432 178.2592 220.46346) with tilt (0 -80.41648 0)
  22 by 4 by 4 MPI processor grid
  bounding box image = (0 -1 -1) to (0 1 1)
  bounding box extra memory = 0.03 MB
  average # of replicas added to proc = 93.32 out of 8192 (1.14%)
  2490368 atoms
  replicate CPU = 0.007 seconds
Neighbor list info ...
  update: every = 20 steps, delay = 0 steps, check = no
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 11
  ghost atom cutoff = 11
  binsize = 5.5, bins = 145 33 41
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair reaxff, perpetual
      attributes: half, newton off, ghost
      pair build: half/bin/ghost/newtoff
      stencil: full/ghost/bin/3d
      bin: standard
  (2) fix qeq/reax, perpetual, copy from (1)
      attributes: half, newton off
      pair build: copy
      stencil: none
      bin: none
Setting up Verlet run ...
  Unit style    : real
  Current step  : 0
  Time step     : 0.1
Per MPI rank memory allocation (min/avg/max) = 422.8 | 425 | 427.8 Mbytes
   Step          Temp          PotEng         Press          E_vdwl         E_coul         Volume    
         0   300           -113.27833      439.019       -111.57687     -1.7014647      28076920     
        10   300.80942     -113.28057      771.84454     -111.57914     -1.7014344      28076920     
        20   302.48468     -113.28543      1617.8995     -111.5841      -1.7013225      28076920     
        30   302.59604     -113.28563      4192.6706     -111.58454     -1.7010941      28076920     
282.800s: flux-shell[0]: FATAL: doom: lmp: rank 313 on host lammps-3 exited and exit-timeout=30s has expired
282.805s: job.exception Æ’XidsvFq type=exec severity=0 lmp: rank 313 on host lammps-3 exited and exit-timeout=30s has expired
flux-job: task(s) Terminated
FLUX-RUN END lammps-iter-1
FLUX-RUN START lammps-iter-2
LAMMPS (2 Apr 2025 - Development - 3215141)
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread. (src/comm.cpp:99)
  using 1 OpenMP thread(s) per MPI task
Reading data file ...
  triclinic box = (0 0 0) to (22.326 11.1412 13.778966) with tilt (0 -5.02603 0)
  11 by 4 by 8 MPI processor grid
  reading atoms ...
  304 atoms
  reading velocities ...
  304 velocities
  read_data CPU = 0.006 seconds
Replication is creating a 32x16x16 = 8192 times larger system...
  triclinic box = (0 0 0) to (714.432 178.2592 220.46346) with tilt (0 -80.41648 0)
  22 by 4 by 4 MPI processor grid
  bounding box image = (0 -1 -1) to (0 1 1)
  bounding box extra memory = 0.03 MB
  average # of replicas added to proc = 93.32 out of 8192 (1.14%)
  2490368 atoms
  replicate CPU = 0.009 seconds
Neighbor list info ...
  update: every = 20 steps, delay = 0 steps, check = no
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 11
  ghost atom cutoff = 11
  binsize = 5.5, bins = 145 33 41
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair reaxff, perpetual
      attributes: half, newton off, ghost
      pair build: half/bin/ghost/newtoff
      stencil: full/ghost/bin/3d
      bin: standard
  (2) fix qeq/reax, perpetual, copy from (1)
      attributes: half, newton off
      pair build: copy
      stencil: none
      bin: none
Setting up Verlet run ...
  Unit style    : real
  Current step  : 0
  Time step     : 0.1
Per MPI rank memory allocation (min/avg/max) = 422.8 | 425 | 427.8 Mbytes
   Step          Temp          PotEng         Press          E_vdwl         E_coul         Volume    
         0   300           -113.27833      439.019       -111.57687     -1.7014647      28076920   
